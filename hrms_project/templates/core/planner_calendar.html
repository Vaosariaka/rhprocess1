{% extends 'base.html' %}
{% block title %}Planning - Calendrier{% endblock %}
{% block content %}
<h1>Calendrier des congés approuvés</h1>
<div id='calendar'></div>

<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js'></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var calendarEl = document.getElementById('calendar');
  var calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,timeGridWeek' },
    events: function(fetchInfo, successCallback, failureCallback) {
      fetch('/api/leaves/')
        .then(r => r.json())
        .then(data => {
          // map API list to FullCalendar events
          const events = data.map(item => ({
            id: item.id,
            title: item['employee'] ? ('Congé: ' + item['employee']) : 'Congé',
            start: item.start_date,
            end: (new Date(item.end_date).toISOString().slice(0,10)),
            allDay: true
          }));
          successCallback(events);
        })
        .catch(e => failureCallback(e));
    }
  });
  calendar.render();
});
</script>

{% endblock %}
