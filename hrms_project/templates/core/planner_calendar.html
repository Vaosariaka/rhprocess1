{% extends 'base.html' %}

{% block title %}Planning - Calendrier{% endblock %}

{% block content %}
<h1>Calendrier des congés approuvés</h1>
<div id="calendar"></div>
{% endblock %}

{% block extrascripts %}
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var calendarEl = document.getElementById('calendar');
  var calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    headerToolbar: { 
        left: 'prev,next today', 
        center: 'title', 
        right: 'dayGridMonth,timeGridWeek' 
    },
    events: function(fetchInfo, success, failure) {
      fetch('/api/leaves/')
        .then(r => r.json())
        .then(data => {
          success(
            data.map(item => ({
              id: item.id,
              title: "Congé : " + item.employee,
              start: item.start_date,
              end: item.end_date,
              allDay: true
            }))
          );
        })
        .catch(failure);
    }
  });
  calendar.render();
});
</script>
{% endblock %}
